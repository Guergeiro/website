#!/bin/bash

(
  # Kill all traces of previously run apps
  console/dev.kill

  # Delete stupid .DS_Store files
  console/delete_ds_store

  echo -n "[watchmedo] Compiling API Reference pages ..."
  deno --allow-read --allow-write --allow-env --allow-net ./compile_api_reference_pages.ts
  echo "... done."

  echo -n "[watchmedo] Compiling Vue global components ..."
  deno --allow-read --allow-write --allow-env --allow-net ./compile_vue_global_components.ts
  echo "... done."

  echo -n "[watchmedo] Compiling Vue route components ..."
  deno --allow-read --allow-write --allow-env --allow-net ./compile_vue_route_components.ts
  echo "... done."

  # Are we restarting or now just starting up?
  if [[ $1 == "restart-by-watchdog" ]]; then
    echo -n "[watchmedo] Restarting docs.ts app ..."
  else
    echo -n "[watchmedo] Starting docs.ts app ..."
  fi
  deno --allow-read --allow-write --allow-env --allow-net ./docs.ts &
  echo "... done."

  echo -e "[watchmedo] Make sure you are running webpack:"
  echo -e "\n    \`npm run dev-webpack -- --watch\`\n"
)
